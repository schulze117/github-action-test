name: Selenium Scraper (Advanced)
on:
  workflow_dispatch:
    inputs:
      target_url:
        description: 'URL to scrape'
        required: true
        default: 'https://api.ipify.org/'
      proxy:
        description: 'Proxy (http://ip:port). Leave empty for none.'
        required: false
        default: ''
      headless:
        description: 'Run Headless'
        type: boolean
        default: false
      incognito:
        description: 'Incognito Mode'
        type: boolean
        default: true
      block_images:
        description: 'Block Images'
        type: boolean
        default: true
      ad_block:
        description: 'Enable Ad Block'
        type: boolean
        default: true

jobs:
  scrape:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Set Locale to German
        run: |
          sudo apt-get install tzdata locales -y && sudo locale-gen de_DE.UTF-8
          sudo localectl set-locale LANG="de_DE.UTF-8"
          export LANG="de_DE.UTF-8"

      - name: Install dependencies
        run: |
          pip install seleniumbase
          sudo apt-get install -y google-chrome-stable xvfb

      - name: Install drivers
        run: |
          seleniumbase install chromedriver
          seleniumbase install uc_driver

      - name: Run Scraper
        run: |
          # Build command with inputs
          CMD="python selenium.py --xvfb --url '${{ github.event.inputs.target_url }}'"
          
          if [ "${{ github.event.inputs.proxy }}" != "" ]; then CMD="$CMD --proxy ${{ github.event.inputs.proxy }}"; fi
          if [ "${{ github.event.inputs.headless }}" == "true" ]; then CMD="$CMD --headless"; fi
          if [ "${{ github.event.inputs.incognito }}" == "true" ]; then CMD="$CMD --incognito"; fi
          if [ "${{ github.event.inputs.block_images }}" == "true" ]; then CMD="$CMD --block-images"; fi
          if [ "${{ github.event.inputs.ad_block }}" == "true" ]; then CMD="$CMD --ad-block"; fi
          
          eval $CMD
